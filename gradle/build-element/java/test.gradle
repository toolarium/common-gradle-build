/*
 * test.gradle
 *
 * Copyright by toolarium, all rights reserved.
 * MIT License: https://mit-license.org
 */

 
test.outputs.upToDateWhen {false}
import org.gradle.api.tasks.testing.logging.TestExceptionFormat


/***************************************************************************************
 * Test
 ***************************************************************************************/
test {
	if (initTesting) {
		systemProperty "file.encoding", "${fileEncoding}"
		useJUnitPlatform()	
		
		testLogging {
			//events("passed", "skipped", "failed")
			events("failed")
			showStackTraces = true
			minGranularity = 3
			exceptionFormat = TestExceptionFormat.FULL
			//stackTraceFilters(org.gradle.api.tasks.testing.logging.TestStackTraceFilter.ENTRY_POINT)
			
			// set options for log level DEBUG
			debug {
				events "started", "skipped", "failed"
				exceptionFormat "full"
			}		

			info.events = ["failed", "skipped"]			
			
			quiet {
				events "failed"
				exceptionFormat "full"				
				showStackTraces true
			}
		}
		
		doFirst {
			if (initTesting) {
				printLine()
			}
		}
	}
}


/***************************************************************************************
 * Defines the dependencies
 ***************************************************************************************/
dependencies {
	if (initTesting) {
	
		if (testImplementationDependency!=null && !testImplementationDependency.isEmpty()) {		
			testImplementation "${testImplementationDependency}"
		}
		
		if (testRuntimeOnlyDependency!=null && !testRuntimeOnlyDependency.isEmpty()) {		
			testRuntimeOnly "${testRuntimeOnlyDependency}"
		}
	}
}
